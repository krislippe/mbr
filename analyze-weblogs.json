{"paragraphs":[{"text":"%pyspark\nprint sc.version","dateUpdated":"Aug 25, 2016 3:23:23 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470853614563_1396761503","id":"20160810-182654_1673153660","result":{"code":"SUCCESS","type":"TEXT","msg":"1.6.1\n"},"dateCreated":"Aug 10, 2016 6:26:54 PM","dateStarted":"Aug 25, 2016 3:23:23 PM","dateFinished":"Aug 25, 2016 3:23:23 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:48","focus":true},{"text":"%pyspark\nbucket = 'lippe-mbr-elb'\nprint bucket\n\nprefix = \"AWSLogs/933939612720/elasticloadbalancing/*/*/*/*\"\nprint prefix\n\nfilename = \"s3://{}/{}\".format(bucket, prefix)\nprint filename\n\nrdd=sc.textFile(filename)\n","dateUpdated":"Aug 25, 2016 3:23:30 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470854015035_-568351988","id":"20160810-183335_848107661","result":{"code":"SUCCESS","type":"TEXT","msg":"lippe-mbr-elb\nAWSLogs/933939612720/elasticloadbalancing/*/*/*/*\ns3://lippe-mbr-elb/AWSLogs/933939612720/elasticloadbalancing/*/*/*/*\n"},"dateCreated":"Aug 10, 2016 6:33:35 PM","dateStarted":"Aug 25, 2016 3:23:30 PM","dateFinished":"Aug 25, 2016 3:23:30 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:49","focus":true},{"text":"%pyspark\nprint rdd.count()\nprint rdd.first()","dateUpdated":"Aug 25, 2016 3:23:34 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470855587764_-1365699494","id":"20160810-185947_1148068308","result":{"code":"SUCCESS","type":"TEXT","msg":"4224\n2016-08-10T21:11:45.108935Z WebSvrLB 205.251.214.10:44582 172.31.89.216:80 0.000036 0.129348 0.000036 200 200 0 7886 \"GET http://WebSvrLB-774749081.us-east-1.elb.amazonaws.com:80/nocache HTTP/1.1\" \"Amazon CloudFront\" - -\n"},"dateCreated":"Aug 10, 2016 6:59:47 PM","dateStarted":"Aug 25, 2016 3:23:34 PM","dateFinished":"Aug 25, 2016 3:24:00 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:50","focus":true},{"text":"%pyspark\nwordcounts = rdd.map(lambda x: x.split())\nprint wordcounts.first()","dateUpdated":"Aug 25, 2016 3:24:08 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470856239406_-432981149","id":"20160810-191039_1021875995","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'2016-08-10T21:11:45.108935Z', u'WebSvrLB', u'205.251.214.10:44582', u'172.31.89.216:80', u'0.000036', u'0.129348', u'0.000036', u'200', u'200', u'0', u'7886', u'\"GET', u'http://WebSvrLB-774749081.us-east-1.elb.amazonaws.com:80/nocache', u'HTTP/1.1\"', u'\"Amazon', u'CloudFront\"', u'-', u'-']\n"},"dateCreated":"Aug 10, 2016 7:10:39 PM","dateStarted":"Aug 25, 2016 3:24:08 PM","dateFinished":"Aug 25, 2016 3:24:09 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:51","focus":true},{"text":"%pyspark\n\n# import matplotlib\nimport matplotlib.pyplot as plt\n# import add from operator module\nfrom operator import add\n\n    \ndef parsedUri(logEntry, columnIndex, splitToken):\n    parts = logEntry.split(' ')[columnIndex].split(splitToken)\n    # return the requestUri, e.g. product.html\n    return parts[0]\n    \ndef histogram(rows):\n    count = map(lambda x: x[1], rows)\n    row = map(lambda x: x[0], rows)\n    plt.barh(range(len(count)), count,color = 'grey')\n    plt.yticks(range(len(count)), row)\n\nfile_in = rdd\n\n### find how many lines we are dealing with\nprint('number of lines in file: %s' % file_in.count())\n\npageList = file_in.map(lambda row: parsedUri(row, 2, \":\"))\n\n# set count 1 per request page\n# e.g. product.html, 1\npageMap = pageList.map(lambda w: (w,1))\n\n# reduce phase - sum count all request url in pageMap\npageReducedMap = pageMap.reduceByKey(add)\n\nsortedMap = pageReducedMap.map(lambda x: (x[1], x[0])).sortByKey(False)\n\n### reverse the key and number\nsortedMap = sortedMap.map(lambda x:(x[1], x[0]))\n\nprint sortedMap.take(20)\n\n# display histogram\nhistogram(sortedMap.take(20))\n","dateUpdated":"Aug 25, 2016 3:24:18 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470857357797_-528771066","id":"20160810-192917_1425199803","result":{"code":"SUCCESS","type":"TEXT","msg":"number of lines in file: 4224\n[(u'72.21.196.65', 1009), (u'72.21.196.64', 870), (u'72.21.196.70', 373), (u'209.58.131.213', 162), (u'173.208.58.138', 162), (u'168.1.92.52', 144), (u'5.178.78.78', 126), (u'72.21.196.68', 123), (u'72.21.196.69', 101), (u'54.182.214.13', 82), (u'50.187.71.5', 61), (u'54.182.214.43', 57), (u'96.85.207.90', 44), (u'100.0.87.4', 30), (u'54.182.230.19', 30), (u'54.182.230.8', 30), (u'54.182.214.52', 23), (u'187.87.199.155', 21), (u'54.182.230.42', 20), (u'185.93.185.10', 20)]\n"},"dateCreated":"Aug 10, 2016 7:29:17 PM","dateStarted":"Aug 25, 2016 3:24:18 PM","dateFinished":"Aug 25, 2016 3:24:50 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:52","focus":true},{"text":"%pyspark\n\ndf = sqlContext.createDataFrame(sortedMap, [\"source\", \"hits\"])\n","dateUpdated":"Aug 25, 2016 3:24:59 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470860349599_-223113289","id":"20160810-201909_486895736","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:19:09 PM","dateStarted":"Aug 25, 2016 3:24:59 PM","dateFinished":"Aug 25, 2016 3:24:59 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:53","focus":true},{"text":"%pyspark\n\ndf.show()","dateUpdated":"Aug 25, 2016 3:25:05 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861025770_333385742","id":"20160810-203025_988033321","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------+----+\n|        source|hits|\n+--------------+----+\n|  72.21.196.65|1009|\n|  72.21.196.64| 870|\n|  72.21.196.70| 373|\n|209.58.131.213| 162|\n|173.208.58.138| 162|\n|   168.1.92.52| 144|\n|   5.178.78.78| 126|\n|  72.21.196.68| 123|\n|  72.21.196.69| 101|\n| 54.182.214.13|  82|\n|   50.187.71.5|  61|\n| 54.182.214.43|  57|\n|  96.85.207.90|  44|\n|    100.0.87.4|  30|\n| 54.182.230.19|  30|\n|  54.182.230.8|  30|\n| 54.182.214.52|  23|\n|187.87.199.155|  21|\n| 54.182.230.42|  20|\n| 185.93.185.10|  20|\n+--------------+----+\nonly showing top 20 rows\n\n"},"dateCreated":"Aug 10, 2016 8:30:25 PM","dateStarted":"Aug 25, 2016 3:25:05 PM","dateFinished":"Aug 25, 2016 3:25:11 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:54","focus":true},{"text":"%pyspark\ndf.registerTempTable(\"sites\")\nsqlContext.sql(\"select * from sites\")","dateUpdated":"Aug 25, 2016 3:25:22 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861228541_1180277723","id":"20160810-203348_1081451681","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:33:48 PM","dateStarted":"Aug 25, 2016 3:25:22 PM","dateFinished":"Aug 25, 2016 3:25:22 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:55","focus":true},{"text":"%sql\nselect * from sites limit 8","dateUpdated":"Aug 25, 2016 3:25:26 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"source","index":0,"aggr":"sum"}],"values":[{"name":"hits","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"hits","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861756743_275511419","id":"20160810-204236_1276526029","result":{"code":"SUCCESS","type":"TABLE","msg":"source\thits\n72.21.196.65\t1009\n72.21.196.64\t870\n72.21.196.70\t373\n209.58.131.213\t162\n173.208.58.138\t162\n168.1.92.52\t144\n5.178.78.78\t126\n72.21.196.68\t123\n","comment":"","msgTable":[[{"key":"hits","value":"72.21.196.65"},{"key":"hits","value":"1009"}],[{"value":"72.21.196.64"},{"value":"870"}],[{"value":"72.21.196.70"},{"value":"373"}],[{"value":"209.58.131.213"},{"value":"162"}],[{"value":"173.208.58.138"},{"value":"162"}],[{"value":"168.1.92.52"},{"value":"144"}],[{"value":"5.178.78.78"},{"value":"126"}],[{"value":"72.21.196.68"},{"value":"123"}]],"columnNames":[{"name":"source","index":0,"aggr":"sum"},{"name":"hits","index":1,"aggr":"sum"}],"rows":[["72.21.196.65","1009"],["72.21.196.64","870"],["72.21.196.70","373"],["209.58.131.213","162"],["173.208.58.138","162"],["168.1.92.52","144"],["5.178.78.78","126"],["72.21.196.68","123"]]},"dateCreated":"Aug 10, 2016 8:42:36 PM","dateStarted":"Aug 25, 2016 3:25:26 PM","dateFinished":"Aug 25, 2016 3:25:31 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:56","focus":true},{"text":"%pyspark\n\nfilename = \"s3://lippe-mbr-elb/parsed-output\"\ndf.write.mode('overwrite').json(filename)","dateUpdated":"Aug 25, 2016 3:25:43 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861870467_67932547","id":"20160810-204430_781869214","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:44:30 PM","dateStarted":"Aug 25, 2016 3:25:43 PM","dateFinished":"Aug 25, 2016 3:26:02 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:57","focus":true},{"text":"%sql\nSELECT * FROM sites order by hits desc limit 10","dateUpdated":"Aug 25, 2016 3:26:07 PM","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"source","index":0,"aggr":"sum"}],"values":[{"name":"hits","index":1,"aggr":"sum"}],"groups":[],"scatter":{"yAxis":{"name":"hits","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470862162003_-281421098","id":"20160810-204922_23026243","result":{"code":"SUCCESS","type":"TABLE","msg":"source\thits\n72.21.196.65\t1009\n72.21.196.64\t870\n72.21.196.70\t373\n173.208.58.138\t162\n209.58.131.213\t162\n168.1.92.52\t144\n5.178.78.78\t126\n72.21.196.68\t123\n72.21.196.69\t101\n54.182.214.13\t82\n","comment":"","msgTable":[[{"key":"hits","value":"72.21.196.65"},{"key":"hits","value":"1009"}],[{"value":"72.21.196.64"},{"value":"870"}],[{"value":"72.21.196.70"},{"value":"373"}],[{"value":"173.208.58.138"},{"value":"162"}],[{"value":"209.58.131.213"},{"value":"162"}],[{"value":"168.1.92.52"},{"value":"144"}],[{"value":"5.178.78.78"},{"value":"126"}],[{"value":"72.21.196.68"},{"value":"123"}],[{"value":"72.21.196.69"},{"value":"101"}],[{"value":"54.182.214.13"},{"value":"82"}]],"columnNames":[{"name":"source","index":0,"aggr":"sum"},{"name":"hits","index":1,"aggr":"sum"}],"rows":[["72.21.196.65","1009"],["72.21.196.64","870"],["72.21.196.70","373"],["173.208.58.138","162"],["209.58.131.213","162"],["168.1.92.52","144"],["5.178.78.78","126"],["72.21.196.68","123"],["72.21.196.69","101"],["54.182.214.13","82"]]},"dateCreated":"Aug 10, 2016 8:49:22 PM","dateStarted":"Aug 25, 2016 3:26:07 PM","dateFinished":"Aug 25, 2016 3:26:11 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:58","focus":true},{"text":"%pyspark\n\nfoo = sc.parallelize([\"hello\", \"how are you\", \"hello how fine\", \"this is for you\", \"how how is this\", \"more this\", \"stuff\"], 3)\nprint foo.collect()\nprint \"gloms combine individual partitions (3) into a single list\"\nprint foo.glom().collect()\ny = foo.map(lambda x: x.split(\" \"))\nprint y.collect()\nz = foo.flatMap(lambda x: x.split(\" \"))\nprint z.collect()\nw = foo.flatMap(lambda x: x.split(\" \")).map(lambda x: (x, 1)).reduceByKey(add)\nw = w.sortBy(lambda a: -a[1])\nprint w.collect()\n","dateUpdated":"Aug 25, 2016 3:26:17 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470862808437_1527958268","id":"20160810-210008_1225378015","result":{"code":"SUCCESS","type":"TEXT","msg":"['hello', 'how are you', 'hello how fine', 'this is for you', 'how how is this', 'more this', 'stuff']\ngloms combine individual partitions (3) into a single list\n[['hello', 'how are you'], ['hello how fine', 'this is for you'], ['how how is this', 'more this', 'stuff']]\n[['hello'], ['how', 'are', 'you'], ['hello', 'how', 'fine'], ['this', 'is', 'for', 'you'], ['how', 'how', 'is', 'this'], ['more', 'this'], ['stuff']]\n['hello', 'how', 'are', 'you', 'hello', 'how', 'fine', 'this', 'is', 'for', 'you', 'how', 'how', 'is', 'this', 'more', 'this', 'stuff']\n[('how', 4), ('this', 3), ('you', 2), ('hello', 2), ('is', 2), ('stuff', 1), ('are', 1), ('for', 1), ('more', 1), ('fine', 1)]\n"},"dateCreated":"Aug 10, 2016 9:00:08 PM","dateStarted":"Aug 25, 2016 3:26:17 PM","dateFinished":"Aug 25, 2016 3:26:18 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:59","focus":true},{"text":"%pyspark\ntt = sqlContext.createDataFrame(w, [\"word\", \"hits\"])\ntt.repartition(1).save(\"s3://lippe-mbr-weblogs/k2\", \"json\", \"overwrite\")\n\ntt.show()\n#filename = \"s3n://lippe-mbr-weblogs/kris\"\n#df.write.mode('overwrite').json(filename)","dateUpdated":"Aug 25, 2016 3:26:27 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470963880125_-1377028224","id":"20160812-010440_362051015","result":{"code":"SUCCESS","type":"TEXT","msg":"+-----+----+\n| word|hits|\n+-----+----+\n|  how|   4|\n| this|   3|\n|  you|   2|\n|hello|   2|\n|   is|   2|\n|stuff|   1|\n|  are|   1|\n|  for|   1|\n| more|   1|\n| fine|   1|\n+-----+----+\n\n"},"dateCreated":"Aug 12, 2016 1:04:40 AM","dateStarted":"Aug 25, 2016 3:26:27 PM","dateFinished":"Aug 25, 2016 3:26:30 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:60","focus":true},{"dateUpdated":"Aug 24, 2016 4:17:36 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1471555932362_-619000071","id":"20160818-213212_57185856","result":{"code":"SUCCESS","type":"TEXT"},"dateCreated":"Aug 18, 2016 9:32:12 PM","dateStarted":"Aug 24, 2016 4:19:06 PM","dateFinished":"Aug 24, 2016 4:19:06 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:61"}],"name":"analyze-weblogs","id":"2BUZDHDB2","angularObjects":{"2B44YVSN1":[],"2AJXGMUUJ":[],"2AK8P7CPX":[],"2AM1YV5CU":[],"2AKK3QQXU":[],"2ANGGHHMQ":[]},"config":{"looknfeel":"default"},"info":{}}