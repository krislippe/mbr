{"paragraphs":[{"text":"%pyspark\nprint sc.version","dateUpdated":"Aug 11, 2016 11:11:36 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470853614563_1396761503","id":"20160810-182654_1673153660","result":{"code":"SUCCESS","type":"TEXT","msg":"1.6.1\n"},"dateCreated":"Aug 10, 2016 6:26:54 PM","dateStarted":"Aug 11, 2016 11:11:36 AM","dateFinished":"Aug 11, 2016 11:11:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:54","focus":true},{"text":"%pyspark\nbucket = 'lippe-mbr-elb'\nprint bucket\n\nprefix = \"AWSLogs/933939612720/elasticloadbalancing/*/*/*/*\"\nprint prefix\n\nfilename = \"s3n://{}/{}\".format(bucket, prefix)\nprint filename\n\nrdd=sc.textFile(filename)\n","dateUpdated":"Aug 11, 2016 11:32:21 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470854015035_-568351988","id":"20160810-183335_848107661","result":{"code":"SUCCESS","type":"TEXT","msg":"lippe-mbr-elb\nAWSLogs/933939612720/elasticloadbalancing/*/*/*/*\ns3n://lippe-mbr-elb/AWSLogs/933939612720/elasticloadbalancing/*/*/*/*\n"},"dateCreated":"Aug 10, 2016 6:33:35 PM","dateStarted":"Aug 11, 2016 11:31:33 AM","dateFinished":"Aug 11, 2016 11:31:33 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:55","focus":true},{"text":"%pyspark\nprint rdd.count()\nprint rdd.first()","dateUpdated":"Aug 11, 2016 11:31:35 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470855587764_-1365699494","id":"20160810-185947_1148068308","result":{"code":"SUCCESS","type":"TEXT","msg":"99\n2016-08-10T21:11:45.108935Z WebSvrLB 205.251.214.10:44582 172.31.89.216:80 0.000036 0.129348 0.000036 200 200 0 7886 \"GET http://WebSvrLB-774749081.us-east-1.elb.amazonaws.com:80/nocache HTTP/1.1\" \"Amazon CloudFront\" - -\n"},"dateCreated":"Aug 10, 2016 6:59:47 PM","dateStarted":"Aug 11, 2016 11:31:35 AM","dateFinished":"Aug 11, 2016 11:31:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:56","focus":true},{"text":"%pyspark\nwordcounts = rdd.map(lambda x: x.split())\nprint wordcounts.first()","dateUpdated":"Aug 11, 2016 11:32:54 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470856239406_-432981149","id":"20160810-191039_1021875995","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'2016-08-10T21:11:45.108935Z', u'WebSvrLB', u'205.251.214.10:44582', u'172.31.89.216:80', u'0.000036', u'0.129348', u'0.000036', u'200', u'200', u'0', u'7886', u'\"GET', u'http://WebSvrLB-774749081.us-east-1.elb.amazonaws.com:80/nocache', u'HTTP/1.1\"', u'\"Amazon', u'CloudFront\"', u'-', u'-']\n"},"dateCreated":"Aug 10, 2016 7:10:39 PM","dateStarted":"Aug 11, 2016 11:32:54 AM","dateFinished":"Aug 11, 2016 11:33:06 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:57","focus":true},{"text":"%pyspark\n\n# import matplotlib\nimport matplotlib.pyplot as plt\n# import add from operator module\nfrom operator import add\n\n    \ndef parsedUri(logEntry, columnIndex, splitToken):\n    parts = logEntry.split(' ')[columnIndex].split(splitToken)\n    # return the requestUri, e.g. product.html\n    return parts[0]\n    \ndef histogram(rows):\n    count = map(lambda x: x[1], rows)\n    row = map(lambda x: x[0], rows)\n    plt.barh(range(len(count)), count,color = 'grey')\n    plt.yticks(range(len(count)), row)\n\nfile_in = rdd\n\n### find how many lines we are dealing with\nprint('number of lines in file: %s' % file_in.count())\n\npageList = file_in.map(lambda row: parsedUri(row, 2, \":\"))\n\n# set count 1 per request page\n# e.g. product.html, 1\npageMap = pageList.map(lambda w: (w,1))\n\n# reduce phase - sum count all request url in pageMap\npageReducedMap = pageMap.reduceByKey(add)\n\nsortedMap = pageReducedMap.map(lambda x: (x[1], x[0])).sortByKey(False)\n\n### reverse the key and number\nsortedMap = sortedMap.map(lambda x:(x[1], x[0]))\n\nprint sortedMap.take(20)\n\n# display histogram\nhistogram(sortedMap.take(20))\n","dateUpdated":"Aug 11, 2016 11:37:20 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470857357797_-528771066","id":"20160810-192917_1425199803","result":{"code":"SUCCESS","type":"TEXT","msg":"number of lines in file: 99\n[(u'100.0.87.4', 30), (u'72.21.196.70', 22), (u'54.239.145.3', 9), (u'54.239.145.62', 8), (u'212.129.63.128', 6), (u'166.137.102.33', 4), (u'5.153.48.170', 3), (u'155.94.254.143', 2), (u'185.93.185.10', 2), (u'167.114.209.211', 2), (u'205.251.214.10', 2), (u'213.128.81.66', 2), (u'54.167.8.23', 2), (u'195.154.33.182', 2), (u'168.1.128.59', 1), (u'205.251.214.80', 1), (u'168.1.128.35', 1)]\n"},"dateCreated":"Aug 10, 2016 7:29:17 PM","dateStarted":"Aug 11, 2016 11:37:20 AM","dateFinished":"Aug 11, 2016 11:37:34 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:58","focus":true},{"text":"%sql\nCREATE EXTERNAL TABLE access_logs\n(\n source String,\n hits smallint\n)\nSTORED AS TEXTFILE\nLOCATION 's3://lippe-mbr-weblogs/kris'","dateUpdated":"Aug 11, 2016 11:38:15 AM","config":{"colWidth":12,"graph":{"mode":"table","height":99,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470858444783_442864402","id":"20160810-194724_551818055","result":{"code":"SUCCESS","type":"TABLE","msg":"result\n","comment":"","msgTable":[],"columnNames":[{"name":"result","index":0,"aggr":"sum"}],"rows":[]},"dateCreated":"Aug 10, 2016 7:47:24 PM","dateStarted":"Aug 11, 2016 11:38:15 AM","dateFinished":"Aug 11, 2016 11:38:15 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:59","focus":true},{"text":"%sql\ndrop table access_logs","dateUpdated":"Aug 11, 2016 11:37:59 AM","config":{"colWidth":12,"graph":{"mode":"table","height":99,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470860292614_1225958338","id":"20160810-201812_2128304344","result":{"code":"SUCCESS","type":"TABLE","msg":"null\n","comment":"","msgTable":[],"columnNames":[{"name":"null","index":0,"aggr":"sum"}],"rows":[]},"dateCreated":"Aug 10, 2016 8:18:12 PM","dateStarted":"Aug 11, 2016 11:37:59 AM","dateFinished":"Aug 11, 2016 11:37:59 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:60","focus":true},{"text":"%pyspark\n\ndf = sqlContext.createDataFrame(sortedMap, [\"source\", \"hits\"])\n","dateUpdated":"Aug 11, 2016 11:38:24 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470860349599_-223113289","id":"20160810-201909_486895736","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:19:09 PM","dateStarted":"Aug 11, 2016 11:38:25 AM","dateFinished":"Aug 11, 2016 11:38:25 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:61","focus":true},{"text":"%pyspark\n\ndf.show()","dateUpdated":"Aug 11, 2016 11:38:28 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861025770_333385742","id":"20160810-203025_988033321","result":{"code":"SUCCESS","type":"TEXT","msg":"+---------------+----+\n|         source|hits|\n+---------------+----+\n|     100.0.87.4|  30|\n|   72.21.196.70|  22|\n|   54.239.145.3|   9|\n|  54.239.145.62|   8|\n| 212.129.63.128|   6|\n| 166.137.102.33|   4|\n|   5.153.48.170|   3|\n| 155.94.254.143|   2|\n|  185.93.185.10|   2|\n|167.114.209.211|   2|\n| 205.251.214.10|   2|\n|  213.128.81.66|   2|\n|    54.167.8.23|   2|\n| 195.154.33.182|   2|\n|   168.1.128.59|   1|\n| 205.251.214.80|   1|\n|   168.1.128.35|   1|\n+---------------+----+\n\n"},"dateCreated":"Aug 10, 2016 8:30:25 PM","dateStarted":"Aug 11, 2016 11:38:28 AM","dateFinished":"Aug 11, 2016 11:38:29 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:62","focus":true},{"text":"%pyspark\ndf.registerTempTable(\"sites\")\nsqlContext.sql(\"select * from sites\")","dateUpdated":"Aug 11, 2016 11:38:35 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861228541_1180277723","id":"20160810-203348_1081451681","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:33:48 PM","dateStarted":"Aug 11, 2016 11:38:35 AM","dateFinished":"Aug 11, 2016 11:38:35 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:63","focus":true},{"text":"%sql\nselect * from sites limit 8","dateUpdated":"Aug 11, 2016 11:38:37 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[{"name":"hits","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":null,"yAxis":{"name":"hits","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861756743_275511419","id":"20160810-204236_1276526029","result":{"code":"SUCCESS","type":"TABLE","msg":"source\thits\n100.0.87.4\t30\n72.21.196.70\t22\n54.239.145.3\t9\n54.239.145.62\t8\n212.129.63.128\t6\n166.137.102.33\t4\n5.153.48.170\t3\n155.94.254.143\t2\n","comment":"","msgTable":[[{"key":"hits","value":"100.0.87.4"},{"key":"hits","value":"30"}],[{"value":"72.21.196.70"},{"value":"22"}],[{"value":"54.239.145.3"},{"value":"9"}],[{"value":"54.239.145.62"},{"value":"8"}],[{"value":"212.129.63.128"},{"value":"6"}],[{"value":"166.137.102.33"},{"value":"4"}],[{"value":"5.153.48.170"},{"value":"3"}],[{"value":"155.94.254.143"},{"value":"2"}]],"columnNames":[{"name":"source","index":0,"aggr":"sum"},{"name":"hits","index":1,"aggr":"sum"}],"rows":[["100.0.87.4","30"],["72.21.196.70","22"],["54.239.145.3","9"],["54.239.145.62","8"],["212.129.63.128","6"],["166.137.102.33","4"],["5.153.48.170","3"],["155.94.254.143","2"]]},"dateCreated":"Aug 10, 2016 8:42:36 PM","dateStarted":"Aug 11, 2016 11:38:37 AM","dateFinished":"Aug 11, 2016 11:38:38 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:64","focus":true},{"text":"%pyspark\n\nfilename = \"s3n://lippe-mbr-elb/parsed-output\"\ndf.write.mode('append').json(filename)","dateUpdated":"Aug 11, 2016 11:39:18 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470861870467_67932547","id":"20160810-204430_781869214","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"Aug 10, 2016 8:44:30 PM","dateStarted":"Aug 11, 2016 11:39:18 AM","dateFinished":"Aug 11, 2016 11:39:20 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:65","focus":true},{"text":"%sql\nSELECT * FROM sites order by hits desc limit 5","dateUpdated":"Aug 11, 2016 11:39:36 AM","config":{"colWidth":12,"graph":{"mode":"pieChart","height":300,"optionOpen":false,"keys":[{"name":"source","index":0,"aggr":"sum"}],"values":[{"name":"hits","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":null,"yAxis":{"name":"hits","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470862162003_-281421098","id":"20160810-204922_23026243","result":{"code":"SUCCESS","type":"TABLE","msg":"source\thits\n100.0.87.4\t30\n72.21.196.70\t22\n54.239.145.3\t9\n54.239.145.62\t8\n212.129.63.128\t6\n","comment":"","msgTable":[[{"key":"hits","value":"100.0.87.4"},{"key":"hits","value":"30"}],[{"value":"72.21.196.70"},{"value":"22"}],[{"value":"54.239.145.3"},{"value":"9"}],[{"value":"54.239.145.62"},{"value":"8"}],[{"value":"212.129.63.128"},{"value":"6"}]],"columnNames":[{"name":"source","index":0,"aggr":"sum"},{"name":"hits","index":1,"aggr":"sum"}],"rows":[["100.0.87.4","30"],["72.21.196.70","22"],["54.239.145.3","9"],["54.239.145.62","8"],["212.129.63.128","6"]]},"dateCreated":"Aug 10, 2016 8:49:22 PM","dateStarted":"Aug 11, 2016 11:39:36 AM","dateFinished":"Aug 11, 2016 11:39:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:66","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1470862808437_1527958268","id":"20160810-210008_1225378015","dateCreated":"Aug 10, 2016 9:00:08 PM","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:67"}],"name":"kris","id":"2BUZDHDB2","angularObjects":{"2B44YVSN1":[],"2AJXGMUUJ":[],"2AK8P7CPX":[],"2AM1YV5CU":[],"2AKK3QQXU":[],"2ANGGHHMQ":[]},"config":{"looknfeel":"default"},"info":{}}